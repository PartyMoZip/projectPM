<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.pm.myapp.mapper.SearchMapper">

    <!-- 페이징 처리된 파티 목록 조회 -->
    <select
            id="getPartyList"
            resultType="com.pm.myapp.domain.PartyVO">

		<![CDATA[
        SELECT
            /*+ index_desc(party) */ *
        FROM party
        OFFSET (#{currPage} - 1) * #{amount} ROWS FETCH NEXT #{amount} ROWS ONLY
        ]]>

    </select>

    <!--페이징 처리된 검색한 파티 목록 조회-->
    <select
            id="getPartyListBySearch"
            parameterType="map"
            resultType="com.pm.myapp.domain.PartyVO">

       <![CDATA[
        SELECT *
        FROM party p
        WHERE partyname LIKE #{searchWord.word1}
           OR p.hobbycode = (SELECT hobbycode FROM hobby WHERE hobbyname LIKE #{word2})
           OR p.localcode = (SELECT localcode FROM localinfo WHERE localname LIKE #{word3})
        ORDER BY partycode DESC
        OFFSET (#{cri.currPage} - 1) * #{cri.amount} ROWS FETCH NEXT #{cri.amount} ROWS ONLY
        ]]>

    </select>

    <!--총 파티 목록 개수-->
    <select
            id="getTotalCount"
            resultType="Integer">

        <![CDATA[
        SELECT COUNT(partycode)
        FROM party
        WHERE partycode > 0
        ]]>

    </select>

    <!--검색어 포함된 총 파티 목록 개수-->
    <select
            id="getTotalCountBySearch"
            parameterType="map"
            resultType="Integer">

        <![CDATA[
        SELECT COUNT(partycode)
        FROM party p
        WHERE partyname LIKE #{searchWord1}
           OR p.hobbycode = (SELECT hobbycode FROM hobby WHERE hobbyname LIKE #{searchWord2})
           OR p.localcode = (SELECT localcode FROM localinfo WHERE localname LIKE #{searchWord3})
        ]]>
    </select>
</mapper>